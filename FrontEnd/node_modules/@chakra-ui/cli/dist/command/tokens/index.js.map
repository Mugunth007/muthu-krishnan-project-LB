{"version":3,"sources":["../../../src/command/tokens/index.ts"],"names":["writeFileAsync","writeFile","runTemplateWorker","themeFile","strictComponentTypes","worker","path","join","__dirname","concat","stdio","cwd","process","Promise","resolve","reject","on","message","errMessage","err","Error","String","generateThemeTypings","out","spinner","start","template","outPath","info","text","succeed","fail","console","error","stop","exit"],"mappings":";;;;;AAAA;;AACA;;AACA;;AACA;;AACA;;AACA;;;;;;;;;;AAOA,IAAMA,cAAc,GAAG,qBAAUC,aAAV,CAAvB;;SAEeC,iB;;;;;+EAAf;AAAA;AAAA;AAAA;AAAA;AAAA;AACEC,YAAAA,SADF,QACEA,SADF,EAEEC,oBAFF,QAEEA,oBAFF;AAOQC,YAAAA,MAPR,GAOiB,yBACbC,iBAAKC,IAAL,CAAUC,SAAV,EAAqB,IAArB,EAA2B,IAA3B,EAAiC,SAAjC,EAA4C,2BAA5C,CADa,EAEb,CAACL,SAAD,EAAYM,MAAZ,CAAmBL,oBAAoB,GAAG,0BAAH,GAAgC,EAAvE,CAFa,EAGb;AACEM,cAAAA,KAAK,EAAE,CAAC,MAAD,EAAS,MAAT,EAAiB,MAAjB,EAAyB,KAAzB,CADT;AAEEC,cAAAA,GAAG,EAAEC,OAAO,CAACD,GAAR;AAFP,aAHa,CAPjB;AAAA,6CAgBS,IAAIE,OAAJ,CAAY,UAACC,OAAD,EAAUC,MAAV,EAAqB;AACtCV,cAAAA,MAAM,CAACW,EAAP,CAAU,SAAV,EAAqB,UAACC,OAAD,EAAyC;AAC5D,oBAAMC,UAAU,GAAID,OAAJ,oBAAIA,OAAD,CAA0BE,GAA7C;;AAEA,oBAAID,UAAJ,EAAgB;AACdH,kBAAAA,MAAM,CAAC,IAAIK,KAAJ,CAAUF,UAAV,CAAD,CAAN;AACD;;AAED,uBAAOJ,OAAO,CAACO,MAAM,CAACJ,OAAD,CAAP,CAAd;AACD,eARD;AASAZ,cAAAA,MAAM,CAACW,EAAP,CAAU,OAAV,EAAmBD,MAAnB;AACD,aAXM,CAhBT;;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,G;;;;SA8BsBO,oB;;;;;kFAAf;AAAA;AAAA;AAAA;AAAA;AAAA;AACLnB,YAAAA,SADK,SACLA,SADK,EAELoB,GAFK,SAELA,GAFK,EAGLnB,oBAHK,SAGLA,oBAHK;AASCoB,YAAAA,OATD,GASW,qBAAI,iCAAJ,EAAuCC,KAAvC,EATX;AAAA;AAAA;AAAA,mBAWoBvB,iBAAiB,CAAC;AACvCC,cAAAA,SAAS,EAATA,SADuC;AAEvCC,cAAAA,oBAAoB,EAApBA;AAFuC,aAAD,CAXrC;;AAAA;AAWGsB,YAAAA,QAXH;AAAA;AAAA,mBAemB,0CAAkBH,GAAlB,CAfnB;;AAAA;AAeGI,YAAAA,OAfH;AAiBHH,YAAAA,OAAO,CAACI,IAAR;AACAJ,YAAAA,OAAO,CAACK,IAAR,qBAA8BF,OAA9B;AAlBG;AAAA,mBAoBG3B,cAAc,CAAC2B,OAAD,EAAUD,QAAV,EAAoB,MAApB,CApBjB;;AAAA;AAqBHF,YAAAA,OAAO,CAACM,OAAR,CAAgB,MAAhB;AArBG;AAAA;;AAAA;AAAA;AAAA;AAuBHN,YAAAA,OAAO,CAACO,IAAR,CAAa,mBAAb;;AACA,gBAAI,wBAAaX,KAAjB,EAAwB;AACtBY,cAAAA,OAAO,CAACC,KAAR,CAAc,aAAEhB,OAAhB;AACD;;AACDO,YAAAA,OAAO,CAACU,IAAR;AACAtB,YAAAA,OAAO,CAACuB,IAAR,CAAa,CAAb;;AA5BG;AAAA;AA8BHX,YAAAA,OAAO,CAACU,IAAR;AA9BG;;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,G","sourcesContent":["import { promisify } from \"util\"\nimport { writeFile } from \"fs\"\nimport { fork, Serializable } from \"child_process\"\nimport path from \"path\"\nimport ora from \"ora\"\nimport {\n  resolveOutputPath,\n  themeInterfaceDestination,\n} from \"./resolve-output-path\"\n\ntype ErrorRecord = Record<\"err\", string>\n\nconst writeFileAsync = promisify(writeFile)\n\nasync function runTemplateWorker({\n  themeFile,\n  strictComponentTypes,\n}: {\n  themeFile: string\n  strictComponentTypes?: boolean\n}): Promise<string> {\n  const worker = fork(\n    path.join(__dirname, \"..\", \"..\", \"scripts\", \"read-theme-file.worker.js\"),\n    [themeFile].concat(strictComponentTypes ? \"--strict-component-types\" : []),\n    {\n      stdio: [\"pipe\", \"pipe\", \"pipe\", \"ipc\"],\n      cwd: process.cwd(),\n    },\n  )\n\n  return new Promise((resolve, reject) => {\n    worker.on(\"message\", (message: ErrorRecord | Serializable) => {\n      const errMessage = (message as ErrorRecord)?.err\n\n      if (errMessage) {\n        reject(new Error(errMessage))\n      }\n\n      return resolve(String(message))\n    })\n    worker.on(\"error\", reject)\n  })\n}\n\nexport async function generateThemeTypings({\n  themeFile,\n  out,\n  strictComponentTypes,\n}: {\n  themeFile: string\n  out: string\n  strictComponentTypes?: boolean\n}) {\n  const spinner = ora(\"Generating chakra theme typings\").start()\n  try {\n    const template = await runTemplateWorker({\n      themeFile,\n      strictComponentTypes,\n    })\n    const outPath = await resolveOutputPath(out)\n\n    spinner.info()\n    spinner.text = `Write file \"${outPath}\"...`\n\n    await writeFileAsync(outPath, template, \"utf8\")\n    spinner.succeed(\"Done\")\n  } catch (e) {\n    spinner.fail(\"An error occurred\")\n    if (e instanceof Error) {\n      console.error(e.message)\n    }\n    spinner.stop()\n    process.exit(1)\n  } finally {\n    spinner.stop()\n  }\n}\n\nexport { themeInterfaceDestination }\n"],"file":"index.js"}